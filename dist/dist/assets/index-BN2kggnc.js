import{_ as Pe,r as i,c as w,o as p,d as t,n as ce,H as je,I as se,J as He,w as oe,p as Ge,K as Ke,e as n,x as $,F,f as s,g as u,j as y,t as m,i as Y,C as Ye,D as Ze,E as B,u as qe,y as O,L as re,M as ie,N as Qe,O as Xe,P as We,Q as ea,R as aa}from"./index-Bqka696Z.js";import{d as ta}from"./vuedraggable.umd-GDNacdoU.js";import{a as fe}from"./card-BIPI8pB_.js";const la={class:"card-type-switch"},na={class:"switch-buttons"},sa={__name:"CardTypeSwitch",emits:["change"],setup(ye,{emit:z}){const L=i("regular"),Z=z,J=C=>{L.value=C,Z("change",C)};return(C,V)=>(p(),w("div",la,[t("div",na,[t("button",{class:ce(["switch-btn",{active:L.value==="shared"}]),onClick:V[0]||(V[0]=A=>J("shared"))}," 共享卡 ",2),t("button",{class:ce(["switch-btn",{active:L.value==="regular"}]),onClick:V[1]||(V[1]=A=>J("regular"))}," 常规卡 ",2)])]))}},oa=Pe(sa,[["__scopeId","data-v-673553cc"]]);function ra(){return je({url:"/api/transactions/card-stats",method:"get"})}const ia={class:"platform-overview"},ca={class:"header-section"},ua={class:"controls-section"},da={class:"action-buttons"},va={class:"card-info-container"},ma={class:"info-item balance-item"},pa={class:"info-content"},fa={class:"info-label"},ya={class:"currency-select"},_a={style:{"margin-right":"6px"}},ga={class:"info-value"},ba={class:"info-item"},ha={class:"info-value"},ka={class:"info-item"},wa={class:"info-label"},Ca={class:"info-value"},Sa={class:"info-item"},xa={class:"info-value"},Ta={class:"card-list-section"},Na={class:"section-header"},Da={class:"tab-controls"},Fa={class:"card-status-tabs"},Oa={class:"tabs-container"},Aa={class:"tabs-list"},Ba=["onClick"],za={class:"action-buttons"},La={class:"card-table-scroll"},Va={class:"table-search-bar"},Ia={class:"pagination-container"},Ra={key:1,class:"empty-state"},Ua={class:"setting-dialog-title"},$a={class:"main-color"},Ja={class:"setting-dialog-flex"},Ea={class:"setting-dialog-left"},Ma={class:"setting-dialog-right"},Pa={class:"setting-drag-item"},ja={style:{"margin-left":"8px"}},Ha={class:"setting-dialog-footer"},Za={__name:"index",setup(ye){const z=He(),L=qe(),Z=se(()=>z.name==="PlatformGZYOverview"),J=i(!1),C=i("regular"),V=i("inUse"),A=i([]),q=i(!1),S=i(1),E=i(10),Q=i(0),x=i({cardBalance:0,openCardCount:0,todayTransactions:0,successRate:0}),_e=[{label:"USD",icon:"🇺🇸"},{label:"EUR",icon:"🇪🇺"}],I=i("USD"),X=i(0),W=i(0),ee=i(0),ae=i(0);let M=[];const d=i({cardBin:"",cardNo:"",nickname:"",cardStatus:""}),P=i({cardBin:"",cardNo:"",nickname:"",cardStatus:""}),j=i(!1),ue=[{key:"applyTime",label:"申请时间",visible:!0},{key:"cardNumber",label:"卡号",visible:!0,disabled:!0},{key:"amount",label:"卡金额",visible:!0},{key:"currency",label:"卡本币",visible:!0},{key:"status",label:"卡状态",visible:!0,formatter:a=>({text:ne(a.status),type:ve(a.status)})},{key:"nickname",label:"昵称",visible:!0},{key:"cardHolder",label:"用卡人",visible:!1},{key:"cardType",label:"卡类型",visible:!1},{key:"lastTransactionDate",label:"最后交易时间",visible:!1},{key:"dailyLimit",label:"单日限额",visible:!1},{key:"issuedBranch",label:"发卡分行",visible:!1},{key:"expiryDate",label:"有效期",visible:!1},{key:"securityLevel",label:"安全等级",visible:!1},{key:"usageScope",label:"使用范围",visible:!1},{key:"cardFeatures",label:"卡片特性",visible:!1}],v=i([]),g=i([]),H=i([]);oe(()=>g.value.slice(),a=>{H.value=v.value.filter(e=>a.includes(e.key))},{immediate:!0}),oe(()=>d.value.dateRange,()=>{S.value=1}),oe(()=>z.name,a=>{a==="PlatformGZYOverview"&&(T(),R(!0))});function ge(){const a=localStorage.getItem("gzy_table_fields");a?v.value=JSON.parse(a):v.value=JSON.parse(JSON.stringify(ue)),g.value=v.value.filter(e=>e.visible).map(e=>e.key)}function te(){localStorage.setItem("gzy_table_fields",JSON.stringify(v.value))}function be(){v.value.forEach(a=>{a.visible=g.value.includes(a.key)}),te(),j.value=!1}function he(){v.value=JSON.parse(JSON.stringify(ue)),g.value=v.value.filter(a=>a.visible).map(a=>a.key),te()}function le(a,e,o=600,b=!1){if(!a)return;typeof a.value!="number"&&(a.value=0);let c=0,h=Number(e),_=performance.now();function D(N){const f=Math.min((N-_)/o,1);a.value=b?Math.floor(f*(h-c)+c):Number((f*(h-c)+c).toFixed(2)),f<1?M.push(requestAnimationFrame(D)):a.value=h}M.push(requestAnimationFrame(D))}function ke(){M.forEach(a=>cancelAnimationFrame(a)),M=[]}const we=()=>{R(!0)},Ce=a=>{I.value=a,R(!0)},Se=a=>{C.value=a},xe=a=>{V.value=a,S.value=1,P.value.cardStatus=a==="all"?"":a,d.value.cardStatus="",T()},T=async()=>{try{if(q.value=!0,J.value){const a=regenerateCardList().data;A.value=a.map(e=>({applyTime:e.createdAt?new Date(e.createdAt).toLocaleString():"",cardNumber:e.maskCardNo,cardType:e.cardScheme,amount:e.cardBalance||0,currency:e.cardCurrency,status:e.cardStatus,nickname:e.nickname,isShare:e.cardType==="share",cardHolder:e.cardHolder,lastTransactionDate:e.createdAt?new Date(e.createdAt).toLocaleString():"",dailyLimit:e.dailyLimit,issuedBranch:e.issuedBranch,expiryDate:e.expiryDate,securityLevel:e.securityLevel,usageScope:e.usageScope,cardFeatures:Array.isArray(e.cardFeatures)?e.cardFeatures.join(","):e.cardFeatures,cardId:e.cardId||`XR${Date.now()}`})),Q.value=a.length}else{const a={pageIndex:S.value,pageSize:E.value,cardType:C.value==="regular"?"recharge":"share",cardCurrency:I.value,...P.value},e=await fe(a);e.code===200?(A.value=e.data.data.map(o=>({applyTime:o.createdAt?new Date(o.createdAt).toLocaleString():"",cardNumber:o.maskCardNo,cardType:o.cardScheme,amount:Number(o.rechargeAmount)||0,currency:o.cardCurrency,status:o.cardStatus,nickname:o.nickname||"-",isShare:o.cardType==="share",cardHolder:o.memberId,cardFormFactor:o.cardFormFactor,cardId:o.cardId,lastTransactionDate:o.createdAt?new Date(o.createdAt).toLocaleString():""})),Q.value=e.data.total):B.error(e.msg||"获取卡片列表失败")}}catch(a){console.error("获取卡片列表失败:",a),B.error(a.message||"获取卡片列表失败")}finally{q.value=!1}};function G(){P.value=JSON.parse(JSON.stringify(d.value)),S.value=1,T()}function Te(){d.value={cardBin:"",cardNo:"",nickname:"",cardStatus:""},P.value=JSON.parse(JSON.stringify(d.value)),S.value=1,T()}const Ne=a=>{S.value=a,T()},De=a=>{E.value=a,S.value=1,T()};se(()=>{const a=A.value,e=a.reduce((o,b)=>o+(b.amount||0),0);return a.filter(o=>o.status==="active").length,{balance:e,openCards:a.length,todayAmount:0,profitRate:0}}),se(()=>{const a=A.value;return{inUse:a.filter(e=>e.status==="active").length,suspended:a.filter(e=>e.status==="disabled").length,all:a.length}});const de=a=>new Intl.NumberFormat("en-US").format(a),R=async(a=!0)=>{try{const e=await ra();e.code===200?(x.value={cardBalance:Number(e.data.totalBalance),openCardCount:e.data.activeCardCount,todayTransactions:Number(e.data.todayTransactionAmount),successRate:e.data.transactionSuccessRate},a?(ke(),le(X,x.value.cardBalance),le(W,x.value.openCardCount),le(ee,x.value.todayTransactions),ae.value=x.value.successRate):(X.value=x.value.cardBalance,W.value=x.value.openCardCount,ee.value=x.value.todayTransactions,ae.value=x.value.successRate)):B.error(e.msg||"获取卡片概览数据失败")}catch(e){console.error("获取卡片概览数据失败:",e),B.error(e.message||"获取卡片概览数据失败")}};function Fe(a){return!!(a.key==="cardNumber"||a.disabled||g.value.length>=8&&!g.value.includes(a.key))}function Oe(a){const e=H.value.map(c=>c.key),o=v.value.filter(c=>g.value.includes(c.key)),b=v.value.filter(c=>!g.value.includes(c.key));o.sort((c,h)=>e.indexOf(c.key)-e.indexOf(h.key)),v.value=[...o,...b],te()}function Ae(){L.push({name:"OpenCard",query:{cardType:C.value}})}async function Be(){const a=aa.service({lock:!0,text:"正在下载卡片列表数据...",background:"rgba(0, 0, 0, 0.7)"});try{const e={pageIndex:1,pageSize:50,cardType:C.value==="regular"?"recharge":"share",cardCurrency:I.value,cardBin:d.value.cardBin||void 0,cardNo:d.value.cardNo||void 0,nickname:d.value.nickname||void 0},o=await fe(e);if(o.code===200){const b=o.data.data.map(r=>({applyTime:r.createdAt?new Date(r.createdAt).toLocaleString():"",cardNumber:r.maskCardNo,cardType:r.cardScheme,amount:Number(r.rechargeAmount)||0,currency:r.cardCurrency,status:r.cardStatus,nickname:r.nickname||"-",isShare:r.cardType==="share",cardHolder:r.memberId,cardFormFactor:r.cardFormFactor,cardId:r.cardId,lastTransactionDate:r.createdAt?new Date(r.createdAt).toLocaleString():""})),c=v.value.filter(r=>r.visible),h=c.map(r=>r.label).join(","),_=b.map(r=>c.map(K=>{let k=r[K.key];return K.key==="status"&&(k=ne(k)),typeof k=="string"&&(k.includes(",")||k.includes('"')||k.includes(`
`))?`"${k.replace(/"/g,'""')}"`:k??""}).join(",")),D=[h,..._].join(`
`),N=new Blob([D],{type:"text/csv;charset=utf-8;"}),f=document.createElement("a");f.href=URL.createObjectURL(N),f.setAttribute("download",`卡片列表_${I.value}_${new Date().toLocaleDateString()}.csv`),document.body.appendChild(f),f.click(),document.body.removeChild(f),B.success("卡片列表下载成功")}else B.error(o.msg||"下载卡片列表失败")}catch(e){console.error("下载卡片列表失败:",e),B.error("下载卡片列表失败，请稍后重试")}finally{a.close()}}function ze(a){L.push({name:"GZYCardDetail",params:{id:a.cardId}})}const ne=a=>({normal:"正常",frozen:"已冻结",cancelled:"已销卡"})[a]||a,ve=a=>({normal:"success",frozen:"warning",cancelled:"danger"})[a]||"info",Le=[{key:"normal",label:"使用中"},{key:"all",label:"所有"},{key:"cancelled",label:"已销卡"},{key:"frozen",label:"已冻结"}],me=i("normal"),Ve=a=>{me.value=a,xe(a)};return Ge(()=>{z.name==="PlatformGZYOverview"&&(T(),R(!0)),ge()}),Ke(()=>{z.name==="PlatformGZYOverview"&&(T(),R(!0))}),(a,e)=>{const o=u("el-button"),b=u("el-dropdown-item"),c=u("el-dropdown-menu"),h=u("el-dropdown"),_=u("el-icon"),D=u("el-input"),N=u("el-form-item"),f=u("el-option"),r=u("el-select"),K=u("el-form"),k=u("el-tag"),pe=u("el-table-column"),Ie=u("el-table"),Re=u("el-pagination"),Ue=u("router-view"),$e=u("el-checkbox"),Je=u("el-checkbox-group"),Ee=u("el-dialog"),Me=Ze("loading");return p(),w(F,null,[t("div",ia,[Z.value?(p(),w(F,{key:0},[t("div",ca,[t("div",ua,[n(oa,{onChange:Se})]),t("div",da,[n(o,{type:"primary",style:{width:"100px","margin-right":"20px"},class:"open-card-btn",onClick:Ae},{default:s(()=>e[10]||(e[10]=[y("开卡")])),_:1})])]),C.value==="regular"?(p(),w(F,{key:0},[t("div",va,[t("div",ma,[e[13]||(e[13]=t("div",{class:"bank-card-mock"},null,-1)),t("div",pa,[t("span",fa,[e[12]||(e[12]=y(" 卡内余额估值 ")),n(h,{onCommand:Ce},{dropdown:s(()=>[n(c,null,{default:s(()=>[(p(),w(F,null,Y(_e,l=>n(b,{key:l.label,command:l.label},{default:s(()=>[t("span",_a,m(l.icon),1),y(m(l.label),1)]),_:2},1032,["command"])),64))]),_:1})]),default:s(()=>[t("span",ya,[y(m(I.value)+" ",1),e[11]||(e[11]=t("i",{class:"el-icon-arrow-down"},null,-1))])]),_:1})]),t("div",ga,[y(m(de(X.value))+" ",1),n(_,{class:"refresh-icon",onClick:we,style:{cursor:"pointer","margin-left":"6px"}},{default:s(()=>[n(O(re))]),_:1})])])]),t("div",ba,[e[14]||(e[14]=t("div",{class:"info-label"},"已开卡数",-1)),t("div",ha,m(W.value),1)]),t("div",ka,[t("div",wa,"今日交易额("+m(I.value)+")",1),t("div",Ca,m(de(ee.value)),1)]),t("div",Sa,[e[15]||(e[15]=t("div",{class:"info-label"},"累计交易成功率",-1)),t("div",xa,m(ae.value),1)])]),t("div",Ta,[t("div",Na,[t("div",Da,[t("div",Fa,[t("div",Oa,[t("div",Aa,[(p(),w(F,null,Y(Le,l=>t("div",{key:l.key,class:ce(["tab-item",{active:me.value===l.key}]),onClick:U=>Ve(l.key)},m(l.label),11,Ba)),64))]),t("div",za,[n(o,{class:"action-btn",onClick:T},{default:s(()=>[n(_,null,{default:s(()=>[n(O(re))]),_:1})]),_:1}),n(o,{class:"action-btn",onClick:Be},{default:s(()=>e[16]||(e[16]=[y("下载卡列表")])),_:1})])])])])]),t("div",La,[t("div",Va,[n(K,{inline:!0,class:"search-form-container"},{default:s(()=>[n(N,null,{default:s(()=>[n(D,{modelValue:d.value.cardBin,"onUpdate:modelValue":e[0]||(e[0]=l=>d.value.cardBin=l),placeholder:"卡BIN",size:"small","prefix-icon":"el-icon-search",clearable:"",style:{width:"120px"},onKeyup:ie(G,["enter"])},null,8,["modelValue"])]),_:1}),n(N,null,{default:s(()=>[n(D,{modelValue:d.value.cardNo,"onUpdate:modelValue":e[1]||(e[1]=l=>d.value.cardNo=l),placeholder:"卡号或末四位",size:"small","prefix-icon":"el-icon-search",clearable:"",style:{width:"180px"},onKeyup:ie(G,["enter"])},null,8,["modelValue"])]),_:1}),n(N,null,{default:s(()=>[n(D,{modelValue:d.value.nickname,"onUpdate:modelValue":e[2]||(e[2]=l=>d.value.nickname=l),placeholder:"输入昵称",size:"small","prefix-icon":"el-icon-search",clearable:"",style:{width:"180px"},onKeyup:ie(G,["enter"])},null,8,["modelValue"])]),_:1}),n(N,null,{default:s(()=>[n(r,{modelValue:d.value.cardStatus,"onUpdate:modelValue":e[3]||(e[3]=l=>d.value.cardStatus=l),placeholder:"卡状态",size:"small",style:{width:"120px"},clearable:""},{default:s(()=>[n(f,{label:"正常",value:"normal"}),n(f,{label:"已冻结",value:"frozen"}),n(f,{label:"已销卡",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),n(N,{class:"search-icon-btns",style:{display:"flex","align-items":"center"}},{default:s(()=>[n(_,{style:{color:"#4f46e5","font-size":"20px",cursor:"pointer","margin-right":"12px"},onClick:G,class:"search-action-icon"},{default:s(()=>[n(O(Qe))]),_:1}),n(_,{style:{color:"#4f46e5","font-size":"20px",cursor:"pointer"},onClick:Te,class:"search-action-icon"},{default:s(()=>[n(O(re))]),_:1})]),_:1})]),_:1})]),Ye((p(),$(Ie,{data:A.value,style:{width:"100%"},"table-layout":"auto"},{default:s(()=>[(p(!0),w(F,null,Y(v.value.filter(l=>l.visible),l=>(p(),$(pe,{key:l.key,prop:l.key,label:l.label,"min-width":l.key==="cardNumber"?120:100,"max-width":180},{default:s(U=>[l.key==="status"?(p(),$(k,{key:0,type:ve(U.row[l.key])},{default:s(()=>[y(m(ne(U.row[l.key])),1)]),_:2},1032,["type"])):(p(),w(F,{key:1},[y(m(U.row[l.key]),1)],64))]),_:2},1032,["prop","label","min-width"]))),128)),n(pe,{label:"",width:"60"},{header:s(()=>[n(_,{class:"setting-table-icon",onClick:e[4]||(e[4]=l=>j.value=!0),style:{cursor:"pointer"}},{default:s(()=>[n(O(ea))]),_:1})]),default:s(l=>[n(h,{trigger:"click"},{dropdown:s(()=>[n(c,null,{default:s(()=>[n(b,{onClick:U=>ze(l.row)},{default:s(()=>[n(_,null,{default:s(()=>[n(O(We))]),_:1}),e[17]||(e[17]=y(" 详情"))]),_:2},1032,["onClick"])]),_:2},1024)]),default:s(()=>[n(_,{style:{cursor:"pointer","font-size":"20px",color:"#6366f1"}},{default:s(()=>[n(O(Xe))]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Me,q.value]]),t("div",Ia,[n(Re,{"current-page":S.value,"onUpdate:currentPage":e[5]||(e[5]=l=>S.value=l),"page-size":E.value,"onUpdate:pageSize":e[6]||(e[6]=l=>E.value=l),"page-sizes":[10,20,50],total:Q.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:De,onCurrentChange:Ne},null,8,["current-page","page-size","total"])])])])],64)):(p(),w("div",Ra,e[18]||(e[18]=[t("p",null,"共享卡功能开发中...",-1)])))],64)):(p(),$(Ue,{key:1}))]),n(Ee,{modelValue:j.value,"onUpdate:modelValue":e[9]||(e[9]=l=>j.value=l),width:"520px","close-on-click-modal":!1},{title:s(()=>[t("span",Ua,[e[19]||(e[19]=y(" 配置 ")),t("span",$a,"("+m(g.value.length)+"/"+m(v.value.length)+")",1)])]),default:s(()=>[t("div",Ja,[t("div",Ea,[n(Je,{modelValue:g.value,"onUpdate:modelValue":e[7]||(e[7]=l=>g.value=l)},{default:s(()=>[(p(!0),w(F,null,Y(v.value,l=>(p(),$($e,{key:l.key,label:l.key,disabled:Fe(l)},{default:s(()=>[y(m(l.label),1)]),_:2},1032,["label","disabled"]))),128))]),_:1},8,["modelValue"])]),t("div",Ma,[e[21]||(e[21]=t("div",{class:"setting-drag-title"},"已选字段（可拖拽排序）",-1)),n(O(ta),{modelValue:H.value,"onUpdate:modelValue":e[8]||(e[8]=l=>H.value=l),"item-key":"key",handle:".drag-handle",onEnd:Oe,class:"setting-drag-list"},{item:s(({element:l})=>[t("div",Pa,[n(_,{class:"drag-handle"},{default:s(()=>e[20]||(e[20]=[t("svg",{width:"18",height:"18",viewBox:"0 0 24 24"},[t("rect",{x:"4",y:"7",width:"16",height:"2",rx:"1",fill:"#bbb"}),t("rect",{x:"4",y:"11",width:"16",height:"2",rx:"1",fill:"#bbb"}),t("rect",{x:"4",y:"15",width:"16",height:"2",rx:"1",fill:"#bbb"})],-1)])),_:1}),t("span",ja,m(l.label),1)])]),_:1},8,["modelValue"])])]),t("div",Ha,[n(o,{type:"primary",onClick:be},{default:s(()=>e[22]||(e[22]=[y("提交")])),_:1}),n(o,{type:"info",plain:"",onClick:he},{default:s(()=>e[23]||(e[23]=[y("恢复默认")])),_:1})])]),_:1},8,["modelValue"])],64)}}};export{Za as default};
