import{_ as O,x as N,o as v,f as t,d as l,aE as A,c as S,U as P,t as V,g as f,r as c,p as q,aF as z,e as s,F as J,i as M,y as H,W as Q,j as b,E as y,aG as R,u as W,az as K,n as X,aB as Y,aH as Z,aI as ee,v as le,A as te}from"./index-Bqka696Z.js";const se={class:"section-header"},ae={class:"section-title"},oe={key:0,class:"section-desc"},ne={class:"section-content"},ie={__name:"SettingSection",props:{title:{type:String,required:!0},desc:{type:String,default:""}},setup(w){return(a,i)=>{const _=f("el-card");return v(),N(_,{class:"setting-section"},{header:t(()=>[l("div",se,[l("div",null,[l("div",ae,V(w.title),1),w.desc?(v(),S("div",oe,V(w.desc),1)):P("",!0)]),A(a.$slots,"header-action",{},void 0,!0)])]),default:t(()=>[l("div",ne,[A(a.$slots,"default",{},void 0,!0)])]),_:3})}}},F=O(ie,[["__scopeId","data-v-f99f0ad1"]]),de={class:"profile-info-list"},ce={class:"profile-label"},re={class:"profile-value"},ue={__name:"UserProfileOverview",setup(w){const a=c({}),i=c(!1),_=c(""),g=c(""),m=c(""),k=c(!1),I=[{key:"username",label:"全名",editable:!0},{key:"email",label:"电子邮箱地址",editable:!0},{key:"phone",label:"手机号",editable:!0},{key:"role",label:"角色",editable:!1}];function G(r){var n;_.value=r,g.value=((n=I.find($=>$.key===r))==null?void 0:n.label)||"",m.value=a.value[r]||"",i.value=!0}async function B(){if(!m.value){y.warning("请输入新的"+g.value);return}k.value=!0;try{const r={};r[_.value]=m.value;const n=await R(r);n.code===200?(a.value[_.value]=n.data[_.value],y.success("更新成功"),i.value=!1):y.error(n.msg||"更新失败")}catch{y.error("更新失败，请稍后重试")}finally{k.value=!1}}return q(async()=>{const r=await z();r.code===200&&(a.value=r.data)}),(r,n)=>{const $=f("el-icon"),D=f("el-input"),E=f("el-form-item"),L=f("el-form"),U=f("el-button"),T=f("el-dialog");return v(),S("div",de,[(v(),S(J,null,M(I,u=>l("div",{class:"profile-row",key:u.key},[l("span",ce,V(u.label),1),l("span",re,V(a.value[u.key]||"-"),1),u.editable?(v(),N($,{key:0,class:"profile-edit-icon",onClick:o=>G(u.key)},{default:t(()=>[s(H(Q))]),_:2},1032,["onClick"])):P("",!0)])),64)),s(T,{modelValue:i.value,"onUpdate:modelValue":n[2]||(n[2]=u=>i.value=u),title:g.value,width:"400px"},{footer:t(()=>[s(U,{onClick:n[1]||(n[1]=u=>i.value=!1)},{default:t(()=>n[3]||(n[3]=[b("取消")])),_:1}),s(U,{type:"primary",loading:k.value,onClick:B},{default:t(()=>n[4]||(n[4]=[b("保存")])),_:1},8,["loading"])]),default:t(()=>[s(L,{"label-position":"top"},{default:t(()=>[s(E,{label:g.value},{default:t(()=>[s(D,{modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=u=>m.value=u),placeholder:"请输入新的"+g.value},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1},8,["modelValue","title"])])}}},fe=O(ue,[["__scopeId","data-v-a08eb8e2"]]),pe={class:"security-card-group"},ve={class:"security-card-title"},_e={class:"security-card-desc"},ge={class:"bind-google-steps"},me={class:"google-card"},ye={class:"google-card-right"},be={class:"google-qrcode-area"},he={class:"google-qrcode"},Ve={class:"qrcode-placeholder"},ke=["src"],xe={class:"google-form"},Se={__name:"SecurityVerifySetting",setup(w){W();const a=c({}),i=c(!1),_=c(!1),g=c(!1),m=c(!1),k=c(!1),I=c(""),G=c(""),B=[{key:"passwordless",title:"无密码验证",icon:Y,enabled:!1,desc:"使用生物识别或设备密码快捷安全登录",btnText:"设置",action:()=>{}},{key:"phone",title:"手机验证",icon:Z,enabled:!0,desc:"使用手机验证码进行双重认证",btnText:"管理",action:()=>{}},{key:"email",title:"邮箱验证",icon:ee,enabled:!1,desc:"使用邮箱验证码进行双重认证",btnText:"设置",action:()=>{}}];function r(){const o=localStorage.getItem("GGisValid");if(!o)return null;try{const e=JSON.parse(o);return!a.value.phone||!a.value.email?null:e.find(p=>p.phone===a.value.phone&&p.email===a.value.email)}catch{return null}}function n(o){let e=[];const p=localStorage.getItem("GGisValid");if(p)try{e=JSON.parse(p)}catch{}const x=e.findIndex(C=>C.phone===a.value.phone&&C.email===a.value.email),h={isValid:o,phone:a.value.phone,email:a.value.email,timestamp:new Date().getTime()};x!==-1?e[x]=h:e.push(h),localStorage.setItem("GGisValid",JSON.stringify(e))}function $(){let o=[];const e=localStorage.getItem("GGisValid");if(e)try{o=JSON.parse(e)}catch{}const p=o.findIndex(x=>x.phone===a.value.phone&&x.email===a.value.email);p!==-1&&(o.splice(p,1),localStorage.setItem("GGisValid",JSON.stringify(o)))}const D=async()=>{if(!G.value){y.warning("请输入验证码");return}try{const o=await te({token:G.value});o.code===200?(_.value=!0,k.value=!1,n(!0),i.value=!0,y.success("绑定并已开启谷歌验证")):y.error(o.msg||"验证码错误")}catch{y.error("请求失败，请稍后重试")}};function E(){$(),i.value=!1,g.value=!1,y.success("已关闭谷歌验证")}function L(){i.value=!0,g.value=!1}function U(){n(!0),i.value=!0,m.value=!1,y.success("已开启谷歌验证")}function T(){i.value=!1,m.value=!1}async function u(){var o;try{const e=await le();e&&typeof((o=e.data)==null?void 0:o.enabled)<"u"&&(_.value=!!e.data.enabled)}catch{}}return q(()=>{const o=localStorage.getItem("userInfo");o&&(a.value=JSON.parse(o));const e=r();i.value=!!(e&&e.isValid),u()}),(o,e)=>{const p=f("el-icon"),x=f("el-link"),h=f("el-button"),C=f("el-dialog"),j=f("el-input");return v(),S(J,null,[l("div",pe,[(v(),S(J,null,M(B,d=>l("div",{class:"security-card",key:d.key},[l("div",ve,[s(p,{class:"security-card-icon"},{default:t(()=>[(v(),N(K(d.icon)))]),_:2},1024),b(" "+V(d.title)+" ",1),l("span",{class:X(["security-status",d.enabled?"enabled":"not-enabled"])},V(d.enabled?"已开启":"未开启"),3)]),l("div",_e,V(d.desc),1),s(x,{class:"security-card-btn",type:"primary",onClick:d.action},{default:t(()=>[b(V(d.btnText),1)]),_:2},1032,["onClick"])])),64))]),s(C,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=d=>g.value=d),title:"确认操作",width:"340px"},{footer:t(()=>[s(h,{onClick:L},{default:t(()=>e[4]||(e[4]=[b("取消")])),_:1}),s(h,{type:"primary",onClick:E},{default:t(()=>e[5]||(e[5]=[b("确认")])),_:1})]),default:t(()=>[e[6]||(e[6]=l("div",null,"确定要关闭本机谷歌验证吗？关闭后下次登录将不再要求谷歌验证。",-1))]),_:1},8,["modelValue"]),s(C,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=d=>m.value=d),title:"确认操作",width:"340px"},{footer:t(()=>[s(h,{onClick:T},{default:t(()=>e[7]||(e[7]=[b("取消")])),_:1}),s(h,{type:"primary",onClick:U},{default:t(()=>e[8]||(e[8]=[b("确认")])),_:1})]),default:t(()=>[e[9]||(e[9]=l("div",null,"已绑定谷歌验证器，是否确认开启本机谷歌验证？",-1))]),_:1},8,["modelValue"]),s(C,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=d=>k.value=d),title:"绑定谷歌验证器",width:"440px",class:"bind-google-dialog"},{default:t(()=>[l("div",ge,[l("div",me,[e[12]||(e[12]=l("div",{class:"google-card-left"},[l("ul",{class:"step-list-custom"},[l("li",null,[l("span",{class:"step-circle"},"1"),l("span",{class:"step-main"},[l("span",{class:"step-label"},"下载谷歌身份验证器"),l("span",{class:"step-desc"},'在手机应用商店搜索"Google Authenticator"下载安装')])]),l("li",null,[l("span",{class:"step-circle"},"2"),l("span",{class:"step-main"},[l("span",{class:"step-label"},"扫描二维码"),l("span",{class:"step-desc"},"打开谷歌验证器，扫描右侧二维码")])]),l("li",null,[l("span",{class:"step-circle"},"3"),l("span",{class:"step-main"},[l("span",{class:"step-label"},"输入验证码"),l("span",{class:"step-desc"},"输入谷歌验证器生成的6位动态验证码完成绑定")])])])],-1)),l("div",ye,[l("div",be,[l("div",he,[l("div",Ve,[I.value?(v(),S("img",{key:0,src:I.value,alt:"谷歌二维码",style:{width:"100px",height:"100px"}},null,8,ke)):(v(),N(p,{key:1},{default:t(()=>e[10]||(e[10]=[l("svg",{viewBox:"0 0 48 48",width:"64",height:"64"},[l("rect",{x:"8",y:"8",width:"32",height:"32",rx:"4",fill:"#f2f3f5",stroke:"#dcdfe6"}),l("rect",{x:"16",y:"16",width:"8",height:"8",fill:"#dcdfe6"}),l("rect",{x:"24",y:"24",width:"8",height:"8",fill:"#dcdfe6"})],-1)])),_:1}))])]),l("div",xe,[s(j,{modelValue:G.value,"onUpdate:modelValue":e[2]||(e[2]=d=>G.value=d),placeholder:"请输入6位验证码",maxlength:"6",class:"google-code-input"},null,8,["modelValue"]),s(h,{type:"primary",class:"google-bind-btn",onClick:D},{default:t(()=>e[11]||(e[11]=[b("绑定")])),_:1})])])])])])]),_:1},8,["modelValue"])],64)}}},we=O(Se,[["__scopeId","data-v-069adc97"]]),Ge={class:"settings-page-group"},Ce={__name:"index",setup(w){const a=c({});return q(async()=>{const i=await z();i.code===200&&(a.value=i.data)}),(i,_)=>(v(),S("div",Ge,[s(F,{title:"基本用户信息"},{default:t(()=>[s(fe)]),_:1}),s(F,{title:"安全验证设置",desc:"您可以用多重验证来提高账户安全性，时刻保护您的资金安全。"},{default:t(()=>[s(we)]),_:1})]))}},$e=O(Ce,[["__scopeId","data-v-1f41a903"]]);export{$e as default};
