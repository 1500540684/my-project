import{_ as te,r as s,I as ne,p as se,c as $,d,e as l,F as re,i as de,f as a,g as r,C as ie,D as ue,x as pe,E as p,J as ce,u as me,o as V,n as fe,t as B,j as i,y as z,O as ve,S as ge,P as _e}from"./index-Bqka696Z.js";import we from"./CreateCardholder-CJRlo82i.js";import ye from"./EditCardholder-DCmC0anT.js";import{g as S,f as Ce}from"./cardholder-BMYgKJ4n.js";import"./card-BIPI8pB_.js";const be={class:"platform-overview"},ke={class:"header-section"},xe={class:"tabs-list"},he=["onClick"],De={class:"action-buttons"},Ve={class:"card-list-section"},ze={class:"table-search-bar"},Se={class:"pagination-container"},Ie={__name:"index",setup(Ee){const x=me(),g=ce(),_=s({name:""}),c=s(1),w=s(10),I=s(0),y=s(!1),E=s([]),u=async()=>{try{y.value=!0;const t={pageIndex:c.value,pageSize:w.value,name:_.value.name},e=await S(t);e.code===200?(E.value=e.data.data.map(n=>Ce(n)),I.value=e.data.total):p.error(e.msg||"获取用卡人列表失败")}catch(t){console.error("获取用卡人列表失败:",t),p.error(t.message||"获取用卡人列表失败")}finally{y.value=!1}},M=ne(()=>E.value);function P(t){w.value=t,c.value=1,u()}function R(t){c.value=t,u()}function F(){c.value=1,u()}function N(){_.value={name:""},c.value=1,u()}se(()=>{u()});const j=[{key:"holder",label:"用卡人"}],T=s("holder");function G(t){T.value=t}const m=s(!1),f=s(!1),h=s(null),C=s(!1),b=s(!1);s(null);async function J(){var t;if(g.query.openCreateDialog==="true"&&(m.value=!0,x.replace({query:{}})),g.query.openEditDialog==="true"&&g.query.cardholderId){try{const e=await S({pageSize:10,pageIndex:1,cardholderId:g.query.cardholderId});e.code===200&&((t=e.data.data)!=null&&t[0])?(h.value=e.data.data[0],f.value=!0):p.error("获取用卡人详情失败")}catch(e){console.error("获取用卡人详情失败:",e),p.error("获取用卡人详情失败")}x.replace({query:{}})}}J();function O(t){return{normal:"success",exception:"warning",disabled:"info",failed:"danger",pending:"warning"}[t]||"info"}async function Y(t){var e;try{const n=await S({pageSize:10,pageIndex:1,cardholderId:t.id});n.code===200&&((e=n.data.data)!=null&&e[0])?(h.value=n.data.data[0],f.value=!0):p.error("获取用卡人详情失败")}catch(n){console.error("获取用卡人详情失败:",n),p.error("获取用卡人详情失败")}}function Z(t){x.push({name:"GZYCardholderDetail",params:{id:t.id}})}function A(){C.value=!1,p.success("用卡人已置为失效")}function H(){b.value=!1,p.success("用卡人已删除")}return(t,e)=>{const n=r("el-button"),K=r("el-input"),U=r("el-form-item"),Q=r("el-form"),v=r("el-table-column"),W=r("el-tag"),D=r("el-icon"),q=r("el-dropdown-item"),X=r("el-dropdown-menu"),ee=r("el-dropdown"),le=r("el-table"),ae=r("el-pagination"),k=r("el-dialog"),oe=ue("loading");return V(),$("div",be,[d("div",ke,[d("div",xe,[(V(),$(re,null,de(j,o=>d("div",{key:o.key,class:fe(["tab-item",{active:T.value===o.key}]),onClick:L=>G(o.key)},B(o.label),11,he)),64))]),d("div",De,[l(n,{type:"primary",plain:"",size:"medium",style:{"border-radius":"6px"},onClick:e[0]||(e[0]=o=>m.value=!0)},{default:a(()=>e[14]||(e[14]=[i("创建用卡人")])),_:1})])]),d("div",Ve,[d("div",ze,[l(Q,{inline:!0,class:"search-form-container"},{default:a(()=>[l(U,null,{default:a(()=>[l(K,{modelValue:_.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>_.value.name=o),placeholder:"姓名",size:"small",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(U,{class:"search-icon-btns"},{default:a(()=>[l(n,{type:"primary",size:"small",onClick:F,loading:y.value},{default:a(()=>e[15]||(e[15]=[i("搜索")])),_:1},8,["loading"]),l(n,{size:"small",onClick:N},{default:a(()=>e[16]||(e[16]=[i("重置")])),_:1})]),_:1})]),_:1})]),ie((V(),pe(le,{data:M.value,style:{width:"100%"},"table-layout":"auto",class:"custom-table"},{default:a(()=>[l(v,{prop:"name",label:"用卡人姓名","min-width":"120"}),l(v,{prop:"phone",label:"手机号","min-width":"120"}),l(v,{prop:"email",label:"邮箱","min-width":"180"}),l(v,{prop:"updateTime",label:"更新时间","min-width":"160"}),l(v,{prop:"status",label:"状态","min-width":"80"},{default:a(o=>[l(W,{type:O(o.row.statusType),effect:o.row.statusType==="pending"?"plain":"light"},{default:a(()=>[i(B(o.row.status),1)]),_:2},1032,["type","effect"])]),_:1}),l(v,{label:"操作",width:"60"},{default:a(o=>[l(ee,{trigger:"click"},{dropdown:a(()=>[l(X,null,{default:a(()=>[l(q,{onClick:L=>Y(o.row)},{default:a(()=>[l(D,null,{default:a(()=>[l(z(ge))]),_:1}),e[17]||(e[17]=i(" 编辑"))]),_:2},1032,["onClick"]),l(q,{onClick:L=>Z(o.row)},{default:a(()=>[l(D,null,{default:a(()=>[l(z(_e))]),_:1}),e[18]||(e[18]=i(" 详情"))]),_:2},1032,["onClick"])]),_:2},1024)]),default:a(()=>[l(D,{style:{cursor:"pointer","font-size":"20px",color:"#6366f1"}},{default:a(()=>[l(z(ve))]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[oe,y.value]]),d("div",Se,[l(ae,{"current-page":c.value,"onUpdate:currentPage":e[2]||(e[2]=o=>c.value=o),"page-size":w.value,"onUpdate:pageSize":e[3]||(e[3]=o=>w.value=o),"page-sizes":[10,20,50],total:I.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),l(k,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=o=>m.value=o),width:"800px",top:"40px","close-on-click-modal":!1,class:"create-cardholder-dialog"},{default:a(()=>[l(we,{onClose:e[4]||(e[4]=()=>{m.value=!1,u()}),onSuccess:e[5]||(e[5]=()=>{m.value=!1,u()})})]),_:1},8,["modelValue"]),l(k,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=o=>f.value=o),width:"800px",top:"40px","close-on-click-modal":!1,class:"create-cardholder-dialog"},{default:a(()=>[l(ye,{cardholder:h.value,onClose:e[7]||(e[7]=()=>{f.value=!1,u()}),onSuccess:e[8]||(e[8]=()=>{f.value=!1,u()})},null,8,["cardholder"])]),_:1},8,["modelValue"]),l(k,{modelValue:C.value,"onUpdate:modelValue":e[11]||(e[11]=o=>C.value=o),width:"420px","show-close":!0,"close-on-click-modal":!1,class:"confirm-dialog"},{header:a(()=>e[19]||(e[19]=[d("span",{class:"confirm-title"},"提示",-1)])),footer:a(()=>[l(n,{type:"danger",onClick:A},{default:a(()=>e[20]||(e[20]=[i("确认")])),_:1}),l(n,{onClick:e[10]||(e[10]=o=>C.value=!1)},{default:a(()=>e[21]||(e[21]=[i("取消")])),_:1})]),default:a(()=>[e[22]||(e[22]=d("div",{class:"confirm-content"},"是否确认将此用卡人置为失效?",-1))]),_:1},8,["modelValue"]),l(k,{modelValue:b.value,"onUpdate:modelValue":e[13]||(e[13]=o=>b.value=o),width:"420px","show-close":!0,"close-on-click-modal":!1,class:"confirm-dialog"},{header:a(()=>e[23]||(e[23]=[d("span",{class:"confirm-title"},"提示",-1)])),footer:a(()=>[l(n,{type:"danger",onClick:H},{default:a(()=>e[24]||(e[24]=[i("确认")])),_:1}),l(n,{onClick:e[12]||(e[12]=o=>b.value=!1)},{default:a(()=>e[25]||(e[25]=[i("取消")])),_:1})]),default:a(()=>[e[26]||(e[26]=d("div",{class:"confirm-content"},"是否确认删除所选用卡人?",-1))]),_:1},8,["modelValue"])])}}},Be=te(Ie,[["__scopeId","data-v-f82c005c"]]);export{Be as default};
