import{_ as ie,r as g,I as q,J as ce,p as ve,c as b,e as n,f as u,g as y,E as m,u as fe,o as c,F as V,i as K,d as e,x as Z,y as B,aB as me,t as s,U as _e,j as h,n as pe,av as be,aw as ge,ax as ye}from"./index-Bqka696Z.js";import{b as he,g as Ae,i as Ne,j as Ie}from"./card-BIPI8pB_.js";const ke={class:"transfer-main"},Ce={class:"custom-icon"},Te={key:1,class:"step-number"},we={key:0,class:"step-content"},xe={class:"refund-card-info"},De={class:"refund-card-info-left"},Ue={class:"refund-row"},Se={class:"refund-value"},Re={class:"refund-row"},qe={class:"refund-value"},Ve={class:"refund-row"},Be={class:"refund-value"},Fe={class:"refund-row"},Me={class:"refund-value"},Ee={class:"refund-row"},Ge={class:"refund-value"},Pe={class:"refund-card-info-right"},Le={class:"card-mock"},Ye={class:"card-number"},$e={class:"form-item"},je={class:"account-option"},He={class:"currency-icon"},Je={style:{"margin-left":"8px",color:"#999"}},Oe={class:"form-item"},Qe={key:0,class:"transfer-detail"},ze={class:"detail-item"},Ke={class:"detail-icon add"},Ze={class:"detail-value"},We={class:"detail-item"},Xe={class:"detail-icon minus"},ea={class:"detail-value"},aa={class:"detail-item"},ta={class:"detail-icon multiply"},sa={class:"detail-value"},la={class:"update-time"},na={class:"total-amount"},oa={class:"value"},ua={class:"btn-row"},ra={key:1,class:"step-content step2-confirm"},da={class:"fee-table-box"},ia={class:"fee-table"},ca={class:"value"},va={class:"value"},fa={class:"value"},ma={class:"value"},_a={class:"value"},pa={class:"value"},ba={class:"value"},ga={class:"value"},ya={class:"action-buttons"},_=20,ha={__name:"Transfer",setup(Aa){const W=["转入","确认"],w=g(0),I=g([]),D=g(""),p=q(()=>I.value.find(t=>t.currency===D.value)),d=g(""),E=fe(),X=ce(),A=q(()=>X.params.id),N=g({}),v=g(!1),l=g({fee:0,exchangeRate:1,finalAmount:0,updateTime:"",expireTime:0,requestId:""});let F=null,k=null;q(()=>!v.value||!p.value||!l.value.finalAmount?!0:Number(p.value.balance)>=Number(l.value.finalAmount));const ee=q(()=>v.value&&l.value.finalAmount>0&&d.value&&!isNaN(Number(d.value))&&Number(d.value)>=_&&p.value&&Number(p.value.balance)>=Number(l.value.finalAmount));async function ae(){try{const t=await Ae();if(t.code===200){I.value=t.data.data.map(o=>({...o,balance:o.realTimeBalance,flag:te(o.currency)}));const a=I.value.find(o=>o.balance>=_)||I.value[0];a&&(D.value=a.currency)}}catch{m.error("获取账户信息失败")}}function te(t){return{USD:"🇺🇸",EUR:"🇪🇺",GBP:"🇬🇧",JPY:"🇯🇵",CNH:"🇨🇳",HKD:"🇭🇰",IDR:"🇮🇩"}[t]||t}function se(t){const a=I.value.find(o=>o.currency===t);!a||Number(a.balance)<_?(m.warning("该币种账户余额不足最低到账金额"),d.value="",v.value=!1):d.value&&P(d.value)}async function G(t){var a,o;try{const x=Date.now().toString(),U=((a=p.value)==null?void 0:a.accountNo)||((o=p.value)==null?void 0:o.accountId);if(!U||!A.value){m.error("缺少账户或卡片信息");return}const M={requestId:x,accountId:U,cardId:A.value,rechargeAmount:t+1},C=await Ie(M);if(C.code===200&&C.data){const f=C.data;l.value={fee:Number(f.rechargeFee),exchangeRate:Number(f.exchangeRate),convertedAmount:Number(f.rechargeAmount),finalAmount:Number(f.rechargeAmount),updateTime:f.quotedAt,expireTime:Date.now()+(f.effectiveQuotationTime?f.effectiveQuotationTime*1e3:3e4),requestId:f.requestId},v.value=!0,k&&clearInterval(k),k=setInterval(()=>{l.value.arrivalAmount&&G(Number(l.value.arrivalAmount))},3e4)}else v.value=!1,l.value={fee:0,exchangeRate:1,convertedAmount:0,finalAmount:0,updateTime:"",expireTime:0,requestId:""},m.error(C.msg||"获取费用信息失败")}catch(x){v.value=!1,l.value={fee:0,exchangeRate:1,convertedAmount:0,finalAmount:0,updateTime:"",expireTime:0,requestId:""},m.error("获取费用信息失败: "+x.message)}}function P(t){if(!t){v.value=!1,k&&(clearInterval(k),k=null);return}F&&clearTimeout(F),F=setTimeout(()=>{if(!/^[0-9]+(\.[0-9]{1,2})?$/.test(t))return;const a=Number(t);if(a<_){m.warning(`单卡到账金额不能低于${_} USD`),v.value=!1;return}if(p.value&&Number(p.value.balance)<a){m.warning("账户余额不足"),v.value=!1;return}G(a)},800)}function le(t){return t||""}ve(async()=>{if(A.value){const t=await he(A.value,!1);t.code===200&&(N.value=t.data)}await ae()});const i=g(null);async function ne(){if(!l.value.requestId||!A.value){m.error("缺少requestId或cardId");return}try{const t=await Ne({requestId:l.value.requestId,cardId:A.value});t.code===200?(i.value=t.data,w.value++,window.scrollTo({top:0,behavior:"smooth"})):m.error(t.msg||"转入失败")}catch(t){m.error("转入失败: "+((t==null?void 0:t.message)||""))}}function oe(){w.value--}function ue(){E.back()}function re(){E.push(`/card/platform_GZY/card-detail/${A.value}`)}return(t,a)=>{const o=y("el-icon"),x=y("el-step"),U=y("el-steps"),M=y("el-option"),C=y("el-select"),f=y("el-input"),S=y("el-button"),de=y("el-card");return c(),b("div",ke,[n(U,{active:w.value,"finish-status":"success","align-center":"",class:"custom-steps"},{default:u(()=>[(c(),b(V,null,K(W,(R,T)=>n(x,{key:T,title:R},{icon:u(()=>[e("div",Ce,[w.value>T?(c(),Z(o,{key:0,class:"check-icon"},{default:u(()=>[n(B(me))]),_:1})):(c(),b("span",Te,s(T+1),1))])]),_:2},1032,["title"])),64))]),_:1},8,["active"]),n(de,{class:"transfer-card"},{default:u(()=>{var R,T,L,Y,$,j,H,J,O,Q,z;return[w.value===0?(c(),b("div",we,[a[18]||(a[18]=e("h2",{class:"step-title"},"转入",-1)),e("div",xe,[e("div",De,[e("div",Ue,[a[2]||(a[2]=e("span",{class:"refund-label"},"卡号",-1)),e("span",Se,s(N.value.maskCardNo||"-"),1)]),e("div",Re,[a[3]||(a[3]=e("span",{class:"refund-label"},"昵称",-1)),e("span",qe,s(N.value.nickname||"-"),1)]),e("div",Ve,[a[4]||(a[4]=e("span",{class:"refund-label"},"卡组织",-1)),e("span",Be,s(N.value.cardScheme||"-"),1)]),e("div",Fe,[a[5]||(a[5]=e("span",{class:"refund-label"},"卡本币",-1)),e("span",Me,s(N.value.cardCurrency||"-"),1)]),e("div",Ee,[a[6]||(a[6]=e("span",{class:"refund-label"},"卡金额",-1)),e("span",Ge,s(N.value.cardBalance||"-"),1)])]),e("div",Pe,[e("div",Le,[a[7]||(a[7]=e("div",{class:"card-logo"},"GO PAY",-1)),e("div",Ye,s(N.value.maskCardNo||"-"),1),a[8]||(a[8]=e("div",{class:"card-date-cvv"},[e("span",null,"**/**"),e("span",null,"***")],-1))])])]),e("div",$e,[a[9]||(a[9]=e("div",{class:"label"},"金额账户",-1)),n(C,{modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=r=>D.value=r),class:"account-select",onChange:se},{default:u(()=>[(c(!0),b(V,null,K(I.value,r=>(c(),Z(M,{key:r.currency,value:r.currency,label:r.flag+" "+r.currency+" ("+r.balance+")",disabled:r.balance<_},{default:u(()=>[e("div",je,[e("span",He,s(r.flag),1),e("span",null,s(r.currency),1),e("span",Je,s(r.balance),1)])]),_:2},1032,["value","label","disabled"]))),128))]),_:1},8,["modelValue"])]),e("div",Oe,[a[11]||(a[11]=e("div",{class:"label"},[e("span",null,"单卡到账金额")],-1)),n(f,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=r=>d.value=r),class:"amount-input",placeholder:"请输入金额",onInput:P,disabled:!p.value},{append:u(()=>a[10]||(a[10]=[h("USD")])),_:1},8,["modelValue","disabled"]),e("div",{class:pe(["min-amount-tip",{"error-tip":d.value&&Number(d.value)<_}])},[d.value&&Number(d.value)<_?(c(),b(V,{key:0},[h(" 单卡到账金额不能低于"+s(_)+"USD ")],64)):(c(),b(V,{key:1},[h(" 最低到账金额: "+s(_)+"USD ")],64))],2)]),v.value?(c(),b("div",Qe,[e("div",ze,[e("div",Ke,[n(o,null,{default:u(()=>[n(B(be))]),_:1})]),a[12]||(a[12]=e("div",{class:"detail-label"},"转入手续费",-1)),e("div",Ze,s(l.value.fee)+" USD",1)]),e("div",We,[e("div",Xe,[n(o,null,{default:u(()=>[n(B(ge))]),_:1})]),a[13]||(a[13]=e("div",{class:"detail-label"},"换汇后金额",-1)),e("div",ea,s(l.value.finalAmount)+" USD",1)]),e("div",aa,[e("div",ta,[n(o,null,{default:u(()=>[n(B(ye))]),_:1})]),a[14]||(a[14]=e("div",{class:"detail-label"},"USD/USD 汇率",-1)),e("div",sa,[e("span",la," 更新于 "+s(le(l.value.updateTime)),1),h(" "+s(l.value.exchangeRate),1)])]),e("div",na,[a[15]||(a[15]=e("div",{class:"label"},"单卡转入金额",-1)),e("div",oa,s(l.value.finalAmount)+" USD",1)])])):_e("",!0),e("div",ua,[n(S,{onClick:ue},{default:u(()=>a[16]||(a[16]=[h("返回")])),_:1}),n(S,{type:"primary",onClick:ne,disabled:!ee.value},{default:u(()=>a[17]||(a[17]=[h("提交")])),_:1},8,["disabled"])])])):(c(),b("div",ra,[a[30]||(a[30]=e("div",{class:"fee-title"},"充值结果",-1)),e("div",da,[e("table",ia,[e("tbody",null,[a[27]||(a[27]=e("tr",{class:"group-title"},[e("td",{colspan:"2"},"充值结果信息")],-1)),e("tr",null,[a[19]||(a[19]=e("td",{class:"label"},"到账金额",-1)),e("td",ca,s(((R=i.value)==null?void 0:R.arrivalAmount)||"-")+" "+s(((T=i.value)==null?void 0:T.arrivalAmountCurrency)||"-"),1)]),e("tr",null,[a[20]||(a[20]=e("td",{class:"label"},"充值金额",-1)),e("td",va,s(((L=i.value)==null?void 0:L.rechargeAmount)||"-")+" "+s(((Y=i.value)==null?void 0:Y.rechargeCurrency)||"-"),1)]),e("tr",null,[a[21]||(a[21]=e("td",{class:"label"},"手续费",-1)),e("td",fa,s((($=i.value)==null?void 0:$.rechargeFee)||"-")+" "+s(((j=i.value)==null?void 0:j.rechargeFeeCurrency)||"-"),1)]),e("tr",null,[a[22]||(a[22]=e("td",{class:"label"},"汇率",-1)),e("td",ma,s(((H=i.value)==null?void 0:H.exchangeRate)||"-"),1)]),e("tr",null,[a[23]||(a[23]=e("td",{class:"label"},"交易号",-1)),e("td",_a,s(((J=i.value)==null?void 0:J.transactionId)||"-"),1)]),e("tr",null,[a[24]||(a[24]=e("td",{class:"label"},"充值状态",-1)),e("td",pa,s(((O=i.value)==null?void 0:O.status)||"-"),1)]),e("tr",null,[a[25]||(a[25]=e("td",{class:"label"},"充值时间",-1)),e("td",ba,s(((Q=i.value)==null?void 0:Q.createdAt)||"-"),1)]),e("tr",null,[a[26]||(a[26]=e("td",{class:"label"},"卡片余额",-1)),e("td",ga,s(((z=i.value)==null?void 0:z.cardBalance)||"-"),1)])])])]),e("div",ya,[n(S,{onClick:oe},{default:u(()=>a[28]||(a[28]=[h("上一步")])),_:1}),n(S,{type:"primary",onClick:re},{default:u(()=>a[29]||(a[29]=[h("完成")])),_:1})])]))]}),_:1})])}}},ka=ie(ha,[["__scopeId","data-v-4bd0afdf"]]);export{ka as default};
